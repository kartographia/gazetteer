if(!javaxt)var javaxt={};if(!javaxt.dhtml)javaxt.dhtml={};
if(!kartographia){var kartographia={}}kartographia.Map=function(l,E){this.className="com.kartographia.Map";var p=this;var G;var M={basemap:"osm",layers:[],center:[45,20],zoom:5,maxZoom:19,style:{info:{background:"rgba(255, 255, 255, 0.5)",fontFamily:'"MS Sans Serif",tahoma,arial,helvetica,sans-serif',fontSize:"8pt",color:"rgba(0,0,0,0.85)",cursor:"default"},coord:{padding:"0 3px 0 0",margin:"0 0 0 -5px",overflowX:"hidden",width:"100px",textAlign:"right"}},coordinateFormat:"DMS"};var t;var q=new ol.format.WKT();var N=new ol.source.Vector();var c=new ol.layer.Vector({source:new ol.source.Vector({})});var x;var B;var a,H,e,u;var C;var z=[];var s=-1;var I=false;var k=false;var L=function(){if(typeof l==="string"){l=document.getElementById(l)}if(!l){return}var T={};F(T,E);var S=T.basemap;if(S){delete T.basemap}F(T,M);E=T;if(S){E.basemap=S}var Q=document.createElement("div");Q.style.position="relative";Q.style.height="100%";Q.setAttribute("desc",p.className);l.appendChild(Q);p.el=Q;a=document.createElement("div");D(a,E.style.info);a.style.position="absolute";a.style.left=0;a.style.bottom=0;a.style.zIndex=1;Q.appendChild(a);H=document.createElement("div");D(H,E.style.info);H.style.position="absolute";H.style.right=0;H.style.bottom=0;H.style.zIndex=1;Q.appendChild(H);e=document.createElement("div");D(e,E.style.coord);e.style.display="inline-block";H.appendChild(e);u=e.cloneNode();H.appendChild(u);t=new ol.Map({controls:ol.control.defaults({attribution:false}),interactions:ol.interaction.defaults({doubleClickZoom:false}),target:Q,view:new ol.View({center:ol.proj.transform([E.center[1],E.center[0]],"EPSG:4326","EPSG:3857"),zoom:E.zoom,maxZoom:E.maxZoom,constrainResolution:true})});G=t.getViewport();if(E.basemap){p.addBaseMap(E.basemap,"basemap")}if(E.layers){for(var R=0;R<E.layers.length;R++){n(E.layers[R])}}n(c).set("name","featureLayer");n(new ol.layer.Vector({source:N})).set("name","drawingLayer");var V=new ol.style.Fill({color:[180,0,0,1]});var W=new ol.style.Stroke({color:[180,0,0,1],width:1});var O=new ol.style.Style({image:new ol.style.Circle({fill:V,stroke:W,radius:3}),fill:V,stroke:W});c.setStyle(O);if(typeof ol.Overlay.Popup!=="undefined"){x=new ol.Overlay.Popup();t.addOverlay(x)}B=new ol.interaction.DragBox({condition:ol.events.condition.always,style:new ol.style.Style({stroke:new ol.style.Stroke({color:[0,0,255,1]})})});B.setActive(false);B.on("boxstart",function(X){k=true;N.clear(true)});B.on("boxend",function(X){k=false;var Y=X.target.getGeometry();var Z=new ol.Feature({geometry:Y.clone()});N.addFeature(Z);Y=Y.clone().transform("EPSG:3857","EPSG:4326");var aa=q.writeGeometry(Y);p.onBoxSelect(aa,Y.getCoordinates())});var U=ol.interaction.DragBox.handleEvent;if(U){B.handleEvent=function(X){if(X.pointerEvent&&X.pointerEvent.pointerType==="touch"){X.pointerEvent.pointerType="mouse"}return U.apply(this,arguments)}}else{}t.addInteraction(B);t.on("moveend",function(){if(I===false){if(s<z.length-1){for(var X=z.length-1;X>s;X--){z.pop()}}z.push({extent:t.getView().calculateExtent(t.getSize()),navStep:t.getSize(),zoom:t.getView().getZoom()});s=s+1}p.onExtentChange()});var P=function(X){return ol.proj.transform(X.coordinate,"EPSG:3857","EPSG:4326")};t.on("pointermove",function(X){var Y=P(X);v(Y[1],Y[0]);p.onMouseMove(Y[1],Y[0])});t.on("singleclick",function(X){var Y=P(X);p.onMouseClick(Y[1],Y[0],X.originalEvent)});t.on("contextmenu",function(X){var Y=P(X);p.onMouseClick(Y[1],Y[0],X.originalEvent)});t.on("dblclick",function(X){if(!k){var Y=P(X);p.onDoubleClick(Y[1],Y[0])}});d(G,function(){var aa=function(){p.resize();J(l,p.resize)};var X=G.getElementsByTagName("canvas").length;if(X===0||isNaN(X)){var Z;var Y=function(){var ab=G.getElementsByTagName("canvas").length;if(ab===0||isNaN(ab)){Z=setTimeout(Y,100)}else{clearTimeout(Z);if(aa){aa.apply(p,[])}}};Z=setTimeout(Y,100)}else{if(aa){aa.apply(p,[])}}})};this.getCanvas=function(){return G.getElementsByTagName("canvas")[0]};this.back=function(){if(s>0){I=true;t.getView().fit(z[s-1].extent,z[s-1].navStep);t.getView().setZoom(z[s-1].zoom);setTimeout(function(){I=false},360);s=s-1}};this.next=function(){if(s<z.length-1){I=true;t.getView().fit(z[s+1].extent,z[s+1].navStep);t.getView().setZoom(z[s+1].zoom);setTimeout(function(){I=false},360);s=s+1}};this.getMap=function(){return t};this.getStatusDiv=function(){return a};this.getCoordinateDiv=function(){return H};this.setCoordinateFormat=function(O){E.coordinateFormat=O};this.updateSize=function(){p.resize()};this.resize=function(){t.updateSize();var P=p.getCanvas();var Q=P.parentNode.offsetWidth;var O=P.parentNode.offsetHeight;P.style.width=Q+"px";P.style.height=O+"px";p.onResize()};this.getZoomLevel=function(){return t.getView().getZoom()};this.getResolution=function(){return t.getView().getResolution()};this.getProjection=function(){return t.getView().getProjection().getCode()};this.getExtent=function(){var O=t.getView();var Q=O.calculateExtent(t.getSize());var P=ol.geom.Polygon.fromExtent(Q);return q.writeGeometry(P.clone().transform("EPSG:3857","EPSG:4326"))};this.setExtent=function(P,R){if(P){P=A(P);var O=t.getView();try{O.fit(P,t.getSize())}catch(Q){console.log(Q)}}if(R!=null){R.call()}};this.containsExtent=function(P){P=A(P);var O=t.getView().calculateExtent(t.getSize());return ol.extent.containsExtent(O,P)};var A=function(Q){if(typeof(Q)==="string"||Q instanceof String){var P=q.readFeature(Q);var O=P.getGeometry();O.transform("EPSG:4326","EPSG:3857");Q=O.getExtent()}else{if(Q instanceof ol.geom.Geometry){Q=Q.getExtent()}else{if(Q instanceof ol.Feature){var O=Q.getGeometry();Q=O.getExtent()}}}return Q};this.setCenter=function(O,Q,P){t.getView().setCenter(ol.proj.transform([Q,O],"EPSG:4326","EPSG:3857"));if(P){t.getView().setZoom(P)}};this.getCenter=function(){var O=t.getView().getCenter();var P=new ol.geom.Point(O).transform("EPSG:3857","EPSG:4326").getCoordinates();return[P[1],P[0]]};this.onExtentChange=function(){};this.onResize=function(){};this.beforeLoad=function(O){};this.onLoad=function(O){};this.onMouseMove=function(O,P){};this.onMouseClick=function(P,Q,O){};this.onDoubleClick=function(O,P){};this.onSelect=function(){};this.onBoxSelect=function(O,P){};this.panTo=function(P,Q,S){var O=t.getView();if(Q!=null){var R=ol.animation.pan({duration:Q,source:O.getCenter()});t.beforeRender(R)}p.setExtent(P,S)};this.popup=function(Q,P){if(typeof(Q)==="string"||Q instanceof String){var O=q.readFeature(Q);Q=O.getGeometry();Q.transform("EPSG:4326","EPSG:3857");Q=Q.getCoordinates()}x.show(Q,P)};this.hidePopup=function(){x.hide()};this.enableBoxSelect=function(){if(arguments.length===1&&arguments[0]===false){B.setActive(false)}else{B.setActive(true)}};this.clearBoxSelect=function(){p.clearDrawings()};this.drawLine=function(O,P){if(O==null){O=new ol.style.Style({stroke:new ol.style.Stroke({color:"#3399cc",width:1})})}w("LineString",O,P)};this.drawPolygon=function(O,P){if(O==null){O=new ol.style.Style({image:null,stroke:new ol.style.Stroke({color:"#3399cc",width:1}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.4)"})})}w("Polygon",O,P)};this.clearDrawings=function(){N.clear(true);j()};var w=function(Q,P,R){j();k=true;var O=new ol.interaction.Draw({source:N,type:Q,style:P});O.on("drawstart",function(S){N.clear(true)});O.on("drawend",function(S){setTimeout(function(){var T=S.feature.getGeometry();T=T.clone().transform("EPSG:3857","EPSG:4326");var U=q.writeGeometry(T);j();if(R){R.apply(p,[U,T])}},100)});t.addInteraction(O)};var j=function(){t.getInteractions().forEach(function(O){if(O instanceof ol.interaction.Draw){t.removeInteraction(O)}});k=false};this.addBaseMap=function(R,Q){if(typeof R==="string"){var P=R.toLowerCase();if((P.indexOf("{x}")>-1&&P.indexOf("{y}")>-1&&P.indexOf("{z}")>-1)){R=new ol.layer.Tile({source:new ol.source.XYZ({url:R})})}else{if(P=="osm"){R=new ol.layer.Tile({source:new ol.source.OSM({crossOrigin:null})})}}}var O=n(R,0);if(Q){O.set("name",Q)}return O};this.addLayer=function(P,O){var Q=t.getLayers().getLength();if(O==null){O=Q-2}else{if(O>Q-2){O=O-2}}return n(P,O)};var n=function(P,O){if(P==null){return}if(O!=null){t.getLayers().insertAt(O,P)}else{t.addLayer(P)}var R=P.getSource();if(R instanceof ol.source.Vector){P.addFeature=function(S){try{this.getSource().addFeature(f(S))}catch(T){console.log(T)}};P.getFeatures=function(){return this.getSource().getFeatures()};P.clear=function(){this.getSource().clear(true)};P.getExtent=function(){return this.getSource().getExtent()}}else{P.clear=function(){};P.getExtent=function(){}}P.show=function(T,U){if(isNaN(T)){this.setVisible(true)}else{var S=this.getOpacity();if(S>0){this.setOpacity(0);this.setVisible(true);m(this,0,S,T,U)}else{this.setVisible(true);if(U){U.apply(p,[this])}}}};P.hide=function(T,U){if(isNaN(T)){this.setVisible(false)}else{var S=this.getOpacity();if(S>0){m(this,S,0,T,function(V){V.setVisible(false);V.setOpacity(S);if(U){U.apply(p,[V])}})}else{this.setVisible(false);if(U){U.apply(p,[this])}}}};P.isVisible=function(){return this.getVisible()};P.setOpacity_=P.setOpacity;P.setOpacity=function(S,T,U){if(isNaN(T)){this.setOpacity_(S)}else{m(this,this.getOpacity(),S,T,U)}};if(P instanceof ol.layer.Tile){var Q=P.getSource();Q.on("tileloadstart",function(){p.beforeLoad(P);clearTimeout(C);a.innerHTML="Loading..."});Q.on(["tileloadend","tileloaderror"],function(){clearTimeout(C);C=setTimeout(function(){a.innerHTML="";p.onLoad(P)},800)});P.refresh=function(){var S=this.getSource();S.tileCache.expireCache({});S.tileCache.clear();if(S.clear){S.refresh()}}}return P};this.getLayers=function(){return o(t.getLayers())};var o=function(O){var P=[];O.forEach(function(Q){if(Q instanceof ol.layer.Group){P.push(Q.getLayers())}else{P.push(Q)}});return P};this.addFeature=function(O){c.addFeature(f(O))};var f=function(Q){if(Q instanceof ol.Feature){return Q}else{var O;if(Q!=null){if(Q.geom){O=i(Q.geom)}else{if(Q.geometry){O=i(Q.geometry)}else{O=i(Q)}}}var P=new ol.Feature({});if(O){P.setGeometry(O)}return P}};var i=function(P){if(typeof P==="string"||P instanceof String){var O=q.readFeature(P);P=O.getGeometry();P.transform("EPSG:4326","EPSG:3857");return P}else{if(P instanceof ol.geom.Geometry){return P}else{return null}}};this.clearFeatures=function(){c.getSource().clear()};this.createPointLayer=function(O,Q){var P=new ol.layer.Vector({source:new ol.source.Vector({}),style:h(O,Q),visible:true});p.addLayer(P);r(P);return P};var h=function(O,P){if(typeof O==="string"){O=ol.color.asArray(O)}var R=new ol.style.Fill({color:O});var Q=new ol.style.Stroke({color:O,width:0});return new ol.style.Style({image:new ol.style.Circle({fill:R,stroke:Q,radius:P}),fill:R,stroke:Q})};this.createVectorLayer=function(O){var Q;if(O){Q=new ol.style.Style({stroke:new ol.style.Stroke({color:O,width:1})})}else{Q=new ol.layer.Vector().getStyleFunction()()}var P=new ol.layer.Vector({source:new ol.source.Vector({}),style:function(S){var T=S.get("style");if(T){return T}var U=S.get("color");var V=S.get("fill");if(U||V){var R={};if(U){R.stroke=new ol.style.Stroke({color:U,width:1})}if(V){R.fill=new ol.style.Fill({color:V})}return new ol.style.Style(R)}return Q}});p.addLayer(P);r(P);return P};var r=function(O){O.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point([-20026376.39,-20048966.1]),style:new ol.style.Style({fill:new ol.style.Fill({color:ol.color.asString([0,0,0,0])})})}));O.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point([20026376.39,20048966.1]),style:new ol.style.Style({fill:new ol.style.Fill({color:ol.color.asString([0,0,0,0])})})}))};this.getTilePreview=function(P,V,U){if(!U){return}var Q=ol.proj.get("EPSG:3857");var O=function(){var W=P.getSource().getTileUrlFunction();var X=[3,2,3];var Y=W(X,1,Q);if(Y){if(Y.indexOf("-4")>-1){Y=Y.replace("-4","3")}}return Y};var S=O();if(S){U.apply(p,[S])}else{var T;var R=function(){var W=O();if(W){clearTimeout(T);U.apply(p,[W])}else{T=setTimeout(R,1000)}};T=setTimeout(R,1000)}};this.getTileGeom=function(X,V,T){var P=y(V,T);var S=y(V+1,T);var Z=g(X,T);var U=g(X+1,T);var O=[U,P];var R=[U,S];var Y=[Z,S];var Q=[Z,P];var W=[O,Q,Y,R,O];return new ol.geom.Polygon([W])};var g=function(O,P){return O/Math.pow(2,P)*360-180};var y=function(R,P){var Q=Math.PI-(2*Math.PI*R)/Math.pow(2,P);var O=Math.atan(Math.sinh(Q));return O*(180/Math.PI)};var b=function(S){var Q=(S.getTileGrid())?S.getTileGrid():ol.tilegrid.getForProjection(t.getView().getProjection()),R=Q.getZForResolution(t.getView().getResolution()),P=Q.getTileRangeForExtentAndZ(t.getView().calculateExtent(t.getSize()),R),O=P.maxX-P.minX+1,T=P.maxY-P.minY+1;return O*T};var m=function(R,Z,W,P,Y,O,Q){if(!O){O=new Date().getTime()}if(!Q){Q=P}var S=new Date().getTime();var V=S-O;if(Q<=V){R.setOpacity(W);if(Y){Y.apply(p,[R])}return}Q-=V;var U=1-(Q/P);var T;var X=Math.abs(Z-W);if(Z<W){T=Z+(X*U)}else{T=Z-(X*U)}R.setOpacity(T);setTimeout(function(){m(R,Z,W,P,Y,S,Q)},33)};var v=function(X,P){if(P>180){while(P>360){P=P-360}}else{if(P<180){while(P<-360){P=P+360}}}if(P>180){P=-180-(180-P)}if(P<-180){P=180+(P+180)}var T=(X>=0)?"N":"S";var R=(P>=0)?"E":"W";if(E.coordinateFormat==="DMS"){var W=1;if(X<0){W=-1}var V=Math.abs(Math.round(X*1000000));var Z=1;if(P<0){Z=-1}var Y=Math.abs(Math.round(P*1000000));var Q=Math.floor(((V/1000000)-Math.floor(V/1000000))*60);var S=Math.floor(((Y/1000000)-Math.floor(Y/1000000))*60);if(Q<10){Q="0"+Q}if(S<10){S="0"+S}var aa=(Math.floor(((((V/1000000)-Math.floor(V/1000000))*60)-Math.floor(((V/1000000)-Math.floor(V/1000000))*60))*100000)*60/100000);var O=(Math.floor(((((Y/1000000)-Math.floor(Y/1000000))*60)-Math.floor(((Y/1000000)-Math.floor(Y/1000000))*60))*100000)*60/100000);if(aa<10){aa="0"+aa}if(O<10){O="0"+O}if(aa.toString().indexOf(".")<0){aa+=".0000"}if(O.toString().indexOf(".")<0){O+=".0000"}X=((Math.floor(V/1000000)*W)+"&deg;"+Q+"'"+aa);P=((Math.floor(Y/1000000)*Z)+"&deg;"+S+"'"+O);var U=(X+"0000").split(".");if(U.length==2){U[1]=U[1].substring(0,4);X=U[0]+"."+U[1]}U=(P+"0000").split(".");if(U.length==2){U[1]=U[1].substring(0,4);P=U[0]+"."+U[1]}X+='" '+T;P+='" '+R}else{X=K(X,9)+" "+T;P=K(P,9)+" "+R}e.innerHTML=P;u.innerHTML=X};var K=function(P,O){return Number(Math.round(parseFloat(P+"e"+O))+"e-"+O)};var F=javaxt.dhtml.utils.merge;var d=javaxt.dhtml.utils.onRender;var D=javaxt.dhtml.utils.setStyle;var J=javaxt.dhtml.utils.addResizeListener;L()};if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.Map=kartographia.Map;
if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.MapMenu=function(i,b){var f=this;var d={style:{thumbnail:"map-tile",label:"map-tile-label map-info"},layers:{}};var a;var j=function(){if(typeof i==="string"){i=document.getElementById(i)}if(!i){return}var k={};g(k,b);g(k,d);b=k;a=document.createElement("div");i.appendChild(a);f.update();f.el=a};this.show=function(){f.el.style.display=""};this.hide=function(){f.el.style.display="none"};this.update=function(){for(var l in b.layers){if(b.layers.hasOwnProperty(l)){var k=b.layers[l];var m=k.div;if(!m){k.div=c(k)}}}};this.onSelect=function(k){};var c=function(m){var o=document.createElement("div");e(o,b.style.thumbnail);a.appendChild(o);var l=document.createElement("div");e(l,b.style.label);l.style.zIndex=1;l.innerHTML=m.name;o.appendChild(l);var n=document.createElement("div");n.style.position="absolute";o.appendChild(n);var k=document.createElement("img");k.src=m.preview;n.appendChild(k);o.onclick=function(){f.onSelect(m)};return o};var g=javaxt.dhtml.utils.merge;var e=javaxt.dhtml.utils.setStyle;var h=javaxt.dhtml.utils.createTable;j()};
if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.MapOverlay=function(e){var c=this;var d;var f=function(){var i=e.el.offsetWidth;var q=e.el.offsetHeight;var n=e.getProjection();var l=e.getMap();var p=l.getView();var r=p.calculateExtent(l.getSize());var m=r[0];var k=r[1];var h=r[2];var g=r[3];var o=e.overlay;if(!o){d=new com.kartographia.MapTile(m,k,h,g,i,q,n);var j=d.getCanvas();j.style.position="absolute";j.style.top=0;j.style.width="100%";j.style.height="100%";e.el.appendChild(j);e.overlay=d}else{d=e.overlay}};this.remove=function(){var g=d.getCanvas();e.el.removeChild(g);e.overlay=null};this.clear=function(){d.clear()};this.addPoint=function(j,k,g,i,h){d.addPoint(j,k,g,i,h)};this.addLine=function(i,g,h){d.addLine(i,g,h)};this.addText=function(k,i,j,g,h){d.addText(k,i,j,g,h)};this.renderTracks=function(K,H,L){if(!K){return}var p=L.tailLength;var F=L.color;var B=L.labels?L.labels.indexOf("device")>-1:false;var l=L.labels?L.labels.indexOf("telemetry")>-1:false;var z=L.speed;if(z!=null){if(z.indexOf("-")===-1){z=[0,parseFloat(z)]}else{var g=z.split("-");z=[parseFloat(g[0]),parseFloat(g[1])]}}for(var I=0;I<K.length;I++){var C=K[I];var h=b(C,H);if(h!=null){var s=h[1];var n=h[0];var o=h[3];var J=h[4];var q=J!=null?(J*2.236936):0;if(z){if(q>=z[0]&&q<=z[1]){}else{continue}}var u=null;if(B==true){u=C.id+""}if(l==true){if(q>0){q=a(q);if(q==0){q=0.1}q+=" mph";if(u==null){u=q}else{u+="\n"+q}if(o!=null){u+=", bearing "+a(o)}}}d.addPoint(s,n,F,5,u);if(o!=null||J!=null){var A=[[s,n]];var r=s;var m=n;var w=H-(p*60*1000);var N=[];for(var G=0;G<C.coords.length;G++){var M=C.coords[G];if(M[2]>=w&&M[2]<H){N.push(M)}}var y=H;for(var y=H;y>=w;y=y-(60*1000)){var v=N.length;for(var E=N.length-1;E>=0;E--){var D=N[E];if(D[2]>y){s=D[1];n=D[0];if(s!=r&&n!=m){A.push([s,n])}v--}}N.length=v;var M=b(C,y);if(M){s=M[1];n=M[0];if(s!=r&&n!=m){A.push([s,n])}r=s;m=n}}if(A.length>1){d.addLine(A,F,1)}}}}};var b=function(g,h){return com.kartographia.utils.getCoord(g.coords,h)};var a=function(g){return Math.round(g*10)/10};f()};
if(!kartographia){var kartographia={}}kartographia.MapTile=function(q,o,p,n,j,i,s){var r=this;var e=0;var d=0;var b=1;var a=1;var c,k;var l=function(){c=document.createElement("canvas");c.width=j;c.height=i;k=c.getContext("2d");if(s=="EPSG:3857"){e=q;d=n;b=j/h(p,q);a=i/h(o,n)}else{if(s=="EPSG:4326"){q=g(q);o=f(o);p=g(p);n=f(n);e=q;d=n;b=j/(p-q);a=i/(o-n)}}};this.getCanvas=function(){return c};this.getImage=function(){return k.getImageData(0,0,c.width,c.height)};this.clear=function(){k.clearRect(0,0,c.width,c.height)};this.addPoint=function(y,u,w,C,A){var v=g(u);var z=f(y);var t=C/2;k.beginPath();k.arc(v,z,t,0,2*Math.PI,false);k.fillStyle=w;k.fill();if(A!=null){var x=A.split("\n");var B=15;k.font=B+"px Arial";k.fillText(x[0],v+t,z);if(x.length>1){k.font="8px Arial";k.fillText(x[1],v+t,(z+B))}}};this.addLine=function(B,v,x){k.strokeStyle=v;if(x){k.lineWidth=x}k.beginPath();for(var w=0;w<B.length;w++){var y=B[w];var z=y[0];var t=y[1];var u=g(t);var A=f(z);if(w==0){k.moveTo(u,A)}else{k.lineTo(u,A)}}k.stroke()};this.addPolygon=function(C,A,v,x){if(v){k.fillStyle=v;k.beginPath();for(var w=0;w<C.length;w++){var y=C[w];var z=y[0];var t=y[1];var u=g(t);var B=f(z);if(w==0){k.moveTo(u,B)}else{k.lineTo(u,B)}}k.closePath();k.fill()}if(A){r.addLine(C,A,x)}};this.addText=function(z,x,y,t,v){var u=g(y);var w=f(x);k.fillStyle=t;k.font=v+"px Arial";k.fillText(z,u,w)};var g=function(u){if(s=="EPSG:3857"){var t=u*20037508.34/180;var v=h(t,e);if(t<e){v=-v}return v*b}else{if(s=="EPSG:4326"){u+=180;var t=(u-e)*b;return t}}};var f=function(t){if(s=="EPSG:3857"){var v=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);v=v*20037508.34/180;var u=h(v,d);if(v>d){u=-u}return u*a}else{if(s=="EPSG:4326"){t=-t;if(t<=0){t=90+-t}else{t=90-t}t=180-t;var v=(t-d)*a;if(m(v)==0||m(v)==-0){v=0}return v}}};var m=function(t){return Math.round(t)};var h=function(u,t){return Math.abs(u-t)};l()};if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.MapTile=kartographia.MapTile;
if(!kartographia){var kartographia={}}kartographia.utils={getTileCoordinate:function(d,g,i){var c=function(m,k,l){return Math.min(Math.max(m,k),l)};var e=c(d,-85.05112878,85.05112878);var b=c(g,-180,180);var h=(b+180)/360*(1<<i);var f=(1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(d*Math.PI/180))/Math.PI)/2*(1<<i);var a=parseInt(Math.trunc(h));var j=parseInt(Math.trunc(f));return[a,j]},line2Polygon:function(v,a){var b=[];for(var w=0;w<v.length;w++){var r=v[w];b.push({x:r[0],y:r[1]})}v=b;if(!k(a)){var n=a;a=[];for(var w=0;w<v.length;w++){a.push(n)}}function m(A,t,C){var B=t.x-A.x,z=t.y-A.y,i=Math.sqrt(B*B+z*z),D=C/(2*i);return{x:-D*z,y:D*B}}function x(t,E,i,C){var A=(E.y-t.y)/(E.x-t.x),z=(C.y-i.y)/(C.x-i.x);if(Math.abs(A-z)<0.00001){return}var G=t.y-A*t.x;var F=i.y-z*i.x;var D=(G-F)/(z-A);var B=A*D+G;return{x:D,y:B}}function k(i){return(Object.prototype.toString.call(i)==="[object Array]")}var y,q,f=[],j,l,u,s,g,e,d,p,c,o;for(var w=0,h=v.length-1;w<h;w++){j=!w;l=(w===v.length-2);y=m(v[w],v[w+1],a[w]);q=m(v[w],v[w+1],a[w+1]);d={x:v[w].x+y.x,y:v[w].y+y.y};p={x:v[w+1].x+q.x,y:v[w+1].y+q.y};c={x:v[w].x-y.x,y:v[w].y-y.y};o={x:v[w+1].x-q.x,y:v[w+1].y-q.y};if(!j){g=x(u[0],u[1],d,p);if(g){f.unshift(g)}e=x(s[0],s[1],c,o);if(e){f.push(e)}}if(j){f.unshift(d);f.push(c)}if(l){f.unshift(p);f.push(o)}if(!l){u=[d,p];s=[c,o]}}for(var w=0;w<f.length;w++){var r=f[w];f[w]=[r.x,r.y]}f.push(f[0]);return f},getCoord:function(k,u){var a=null;var x=null;var s=null;var w=function(e,j){return window.getLatLon(j,e)};var b=function(j,e){return j.distanceTo(e)};var z=function(t,j){var e=t.initialBearingTo(j);return isNaN(e)?0:e};var o=function(t,A,e){var j=t.destinationPoint(A,e);return[j.longitude,j.latitude]};for(var r=0;r<k.length;r++){var q=k[r];var l=q[2];if(l>u){x=q;if(r>0){s=k[r-1];var h=s[2];if(h==l){a=s;if(r>1){s=k[r-2]}else{s=null}}}break}}if(s!=null){var p=w(s[0],s[1]);var i=s[2];var d;var v;if(s.length<4){var n;var h;if(a!=null){n=w(a[0],a[1]);h=a[2]}else{n=w(x[0],x[1]);h=x[2]}var c=b(p,n);var f=(h-i)/1000;v=c/f;d=z(p,n);s.push(d);s.push(v)}else{d=s[3];v=s[4]}var g=(u-i)/1000;var m=v*g;try{a=o(p,m,d);a.push(u);a.push(d);a.push(v)}catch(y){}}return a}};if(!com){var com={}}if(!com.kartographia){com.kartographia={}}com.kartographia.utils=kartographia.utils;